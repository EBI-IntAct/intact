<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"

                xmlns:iv="http://java.sun.com/jsf/composite/intactview"
                xmlns:iamf="http://intact.ebi.ac.uk/mitabfunctions"
                xmlns:iaf="http://intact.ebi.ac.uk/functions"
                xmlns:iav="http://intact.ebi.ac.uk/view"
                xmlns:iax="http://intact.ebi.ac.uk/extlinks"

                xmlns:composite="http://java.sun.com/jsf/composite"
                xmlns:ot="http://myfaces.apache.org/orchestra">

    <!-- INTERFACE -->
    <composite:interface>
        <composite:attribute name="participant" type="uk.ac.ebi.intact.model.Component" required="true"/>
        <composite:attribute name="text" required="true"/>
        <composite:attribute name="style"/>
        <composite:attribute name="visible" type="java.util.Boolean" default="true"/>
    </composite:interface>

    <!-- IMPLEMENTATION -->
    <composite:implementation>

        <h:panelGroup rendered="#{cc.attrs.visible}">

            <p:commandLink id="participantLink" type="button" onclick="participantDlg.show();" update="participantDetailsPanel">
                <h:outputText value="#{cc.attrs.text}" style="#{cc.attrs.style}"/>
            </p:commandLink>

            <p:dialog header="Participant: #{cc.attrs.participant.interactor.fullName}"
                      widgetVar="participantDlg" height="400" width="750" fixedCenter="true"
                      constrainToViewport="true" modal="false">

                <h:panelGroup id="participantDetailsPanel">

                <h3>Participant: #{cc.attrs.participant.interactor.fullName}</h3>

                    <iv:panelLabelAndMessage label="Accession:" labelStyle="font-weight:bold;">
                        <h:outputText value="#{cc.attrs.participant.ac}"/>
                    </iv:panelLabelAndMessage>
    
                    <iv:panelLabelAndMessage label="Name:" labelStyle="font-weight:bold;">
                        <h:outputText value="#{cc.attrs.participant.interactor.shortLabel}"/>
                    </iv:panelLabelAndMessage>
    
                    <iv:panelLabelAndMessage label="Primary identifier:" labelStyle="font-weight:bold;">
                        <ui:repeat var="xref" value="#{iaf:getIdentityXrefs(cc.attrs.participant.interactor)}">
                            <h:outputLink value="#{iaf:calculateDbXrefUrl(xref.cvDatabase, xref.primaryId)}" target="_blank">
                                <h:outputText value="#{xref.primaryId}"/>
                                </h:outputLink>
                        </ui:repeat>
                    </iv:panelLabelAndMessage>
    
                    <iv:panelLabelAndMessage label="Molecule type:" labelStyle="font-weight:bold;">
                            <h:outputText value="#{cc.attrs.participant.interactor.cvInteractorType.shortLabel}"/>
                    </iv:panelLabelAndMessage>
    
                    <iv:panelLabelAndMessage label="Stoichiometry:" labelStyle="font-weight:bold;" visible="#{cc.attrs.participant.stoichiometry > 0}">
                        <h:outputText value="#{cc.attrs.participant.stoichiometry}"/>
                    </iv:panelLabelAndMessage>

                    <iv:panelLabelAndMessage label="Cross References:" visible="#{not empty cc.attrs.participant.xrefs}"
                                             labelStyle="font-weight:bold;">
                         <iv:xrefTable xrefs="#{cc.attrs.participant.xrefs}" />
                    </iv:panelLabelAndMessage>
    
                    <iv:panelLabelAndMessage label="Annotations:" visible="#{not empty cc.attrs.participant.annotations}"
                                             labelStyle="font-weight:bold;">
                        <iv:annotationTable annotations="#{cc.attrs.participant.annotations}" />
                    </iv:panelLabelAndMessage>
    
                    <iv:panelLabelAndMessage label="Experimental features:" visible="#{not empty cc.attrs.participant.bindingDomains}"
                                             labelStyle="font-weight:bold;">

                        <ui:decorate template="/pages/details/bindingDomains.xhtml">
                            <ui:param name="bindingDomains" value="#{cc.attrs.participant.bindingDomains}"/>
                        </ui:decorate>
                    </iv:panelLabelAndMessage>
    
                    <iv:panelLabelAndMessage label="Experimental Parameters:" visible="#{not empty cc.attrs.participant.parameters}"
                                             labelStyle="font-weight:bold;">
    
                        <ui:decorate template="/pages/details/parameters.xhtml">
                            <ui:param name="parameters" value="#{cc.attrs.participant.parameters}"/>
                        </ui:decorate>
                    </iv:panelLabelAndMessage>
    
                </h:panelGroup>

            </p:dialog>
        </h:panelGroup>

    </composite:implementation>

</ui:composition>