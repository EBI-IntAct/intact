<?xml version="1.0" encoding="UTF-8"?>
<html>
<head>
    <title>Interaction viewer Redirect</title>

    <script src="http://code.jquery.com/jquery-2.1.3.min.js" type="text/javascript"></script>
    <script src="../resources/javascript/complexViewer-0.0.1.min.js" type="text/javascript"></script>

</head>

<body>

<div id='controls'>
    <button onclick="xlv.autoLayout();">Auto layout</button>
    <button onclick="xlv.resetZoom();">Reset zoom</button>
    <button onclick="xlv.exportSVG();">Export SVG</button>
</div>
<div id="networkContainer">
    Interaction Graph should show here in a few moments
    <br/>It can take a few minutes if you try to upload a lot of interactions...
</div>
<script type="text/javascript">
    //<![CDATA[
    var ac = getQueryVariable("ac");
    var objType = getQueryVariable("objType")

    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i=0;i<vars.length;i++) {
            var pair = vars[i].split("=");
            if (pair[0] == variable) {
                return pair[1];
            }
        }
        alert('Query Variable ' + variable + ' not found');
    }

    var exportUrl = '#{facesContext.externalContext.requestContextPath}/service/export/mi/'+objType+'?ac='+ac+'&format=json';

    var targetDiv = document.getElementById('networkContainer');
    var xlv = new xiNET(targetDiv);

    // wait for the data to be loaded prior, handy for larger network.
    var miJson;
    jQuery.ajax({
        url: exportUrl,
        success: function(gotJson) {
            miJson = gotJson;
            xlv.readMIJSON(miJson, true);
        },
        error: function() {
            var element = document.getElementById("networkContainer");
            $(element).empty();
            $(element).append("An error occurred while loading the data.");
        }});
    //]]>
</script>
</body>
</html>
