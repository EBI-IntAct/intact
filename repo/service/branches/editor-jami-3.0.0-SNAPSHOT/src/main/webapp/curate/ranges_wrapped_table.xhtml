<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ia="http://java.sun.com/jsf/composite/intact-components"
                xmlns:ed="http://ebi.ac.uk/intact/editor/ui">

    <p:dataTable id="rangesTable" var="rangeWrapper" value="#{value}"
                 paginator="true" rows="10" paginatorAlwaysVisible="false" paginatorPosition="both">
        <p:column style="width:16px">
            <p:rowToggler/>
        </p:column>
        <p:column>
            <f:facet name="header">
                <h:outputText value="AC"/>
            </f:facet>
            <h:outputText value="#{rangeWrapper.range.ac}" styleClass="#{changesController.isDeletedAc(rangeWrapper.range.ac)? 'intact-deleted' : ''}"/>
        </p:column>
        <p:column>
            <f:facet name="header">
                <h:outputText value="Value"/>
            </f:facet>
            <h:inputText id="rangeTxt" value="#{rangeWrapper.rangeAsString}"
                         validator="#{rangeWrapper.validateRange}"
                         required="true"
                         requiredMessage="Range value is required"
                         readonly="#{changesController.isDeletedAc(rangeWrapper.range.ac)}"
                         styleClass="#{changesController.isDeletedAc(rangeWrapper.range.ac)? 'intact-deleted' : ''}"
                         style="font-family: monospace">
                <f:ajax event="valueChange" render=":editorForm:featureTabs:rangesPanel :editorForm:messagesComponent :editorForm:changesPanel :editorForm:unsavedChangesInfo"
                        listener="#{rangeWrapper.onRangeAsStringChanged}" onevent="markAsUnsaved()"/>
            </h:inputText>

            <h:panelGroup id="validityPanel">

                <h:panelGroup rendered="#{not rangeWrapper.validRange}">
                                    <span class="ui-icon ui-icon-alert" style="display:inline-block"
                                          title="#{rangeWrapper.badRangeInfo}"/>
                </h:panelGroup>
            </h:panelGroup>
        </p:column>
        <p:column>
            <f:facet name="header">
                <h:outputText value="From type"/>
            </f:facet>
            <h:selectOneMenu id="fromCvFuzzyType" value="#{rangeWrapper.range.start.status}" converter="cvObjectConverter"
                             required="true"
                             requiredMessage="Range from CvFuzzyType is required" disabled="#{annotatedObjetController.isRangeDisabled()}">
                <f:ajax event="valueChange" render=":editorForm:featureTabs:rangesPanel :editorForm:messagesComponent :editorForm:changesPanel :editorForm:unsavedChangesInfo"
                        listener="#{rangeWrapper.onFuzzyTypeChanged}" onevent="markAsUnsaved()"/>
                <f:selectItems value="#{cvObjectService.fuzzyTypeSelectItems}"/>
            </h:selectOneMenu>
        </p:column>
        <p:column>
            <f:facet name="header">
                <h:outputText value="To type"/>
            </f:facet>
            <h:selectOneMenu id="toCvFuzzyType" value="#{rangeWrapper.range.end.status}" converter="cvObjectConverter"
                             required="true"
                             requiredMessage="Range to CvFuzzyType is required" disabled="#{featureController.isRangeDisabled()}">
                <f:ajax event="valueChange" render=":editorForm:messagesComponent :editorForm:changesPanel :editorForm:unsavedChangesInfo"
                        listener="#{rangeWrapper.onFuzzyTypeChanged}" onevent="markAsUnsaved()"/>
                <f:selectItems value="#{cvObjectService.fuzzyTypeSelectItems}"/>
            </h:selectOneMenu>
        </p:column>
        <p:column>
            <f:facet name="header">
                <h:outputText value="Intramolecular"/>
            </f:facet>
            <h:selectBooleanCheckbox value="#{rangeWrapper.range.linked}" disabled="#{annotatedObjetController.isRangeDisabled()}">
                <f:ajax event="valueChange" render=":editorForm:messagesComponent :editorForm:changesPanel :editorForm:unsavedChangesInfo"
                        onevent="markAsUnsaved()"/>
             </h:selectBooleanCheckbox>
        </p:column>
        <p:column>
            <f:facet name="header">
                <h:outputText value="Actions"/>
            </f:facet>
            <p:commandLink id="markDeletedBtn" process="markDeletedBtn" immediate="true" title="Mark to be deleted" styleClass="ui-icon ui-icon-closethick"
                           actionListener="#{annotatedObjetController.markRangeToDelete(rangeWrapper)}"
                           update=":editorForm:changesPanel,:editorForm:messagesComponent,:editorForm:unsavedChangesInfo" rendered="#{not changesController.isDeletedAc(rangeWrapper.range.ac)}"
                           />
            <p:commandLink id="revertBtn" process="revertBtn" immediate="true" title="Revert" styleClass="ui-icon ui-icon-arrowreturnthick-1-w"
                           actionListener="#{annotatedObjetController.revert(rangeWrapper.range)}"
                           update=":editorForm:changesPanel,:editorForm:messagesComponent,:editorForm:unsavedChangesInfo" rendered="#{changesController.isDeletedAc(rangeWrapper.range.ac)}"/>
        </p:column>

        <p:rowExpansion id="resultingSeqExpansion">
            <h:panelGrid columns="2" rendered="#{rangeWrapper.range.resultingSequence != null}">
                <h:outputText value="Original Sequence:"/>
                <p:inputTextarea value="#{rangeWrapper.range.resultingSequence.originalSequence}" readonly="true" cols="60" rows="3"
                                 rendered="#{rangeWrapper.range.resultingSequence.originalSequence != null}"/>
                <h:outputText value="" rendered="#{rangeWrapper.range.resultingSequence.originalSequence == null}"/>

                <h:outputText value="New sequence (mutated sequence):"/>
                <p:inputTextarea value="#{rangeWrapper.range.resultingSequence.newSequence}" cols="60" rows="3"/>

                <h:outputText value="Refers to participant:"/>
                <h:selectOneMenu id="linkedParticipantMenu" value="#{rangeWrapper.participant}" converter="modelledParticipantConverter"
                                 rendered="#{annotatedObjetController.complexFeature}" disabled="#{!annotatedObjetController.complexFeature
                                 or annotatedObjetController.isRangeDisabled()}">
                    <f:ajax event="valueChange" render=":editorForm:featureTabs:rangesPanel :editorForm:messagesComponent :editorForm:changesPanel :editorForm:unsavedChangesInfo"
                            onevent="markAsUnsaved()"/>
                    <f:selectItems value="#{annotatedObjectController.participantSelectItems}"/>
                </h:selectOneMenu>
            </h:panelGrid>
        </p:rowExpansion>

    </p:dataTable>

</ui:composition>
